<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/Assembler.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">src</a> Assembler.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.91% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>91/92</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.89% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>34/37</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.91% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>91/92</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37x</span>
<span class="cline-any cline-yes">7558x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7557x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4032x</span>
<span class="cline-any cline-yes">4030x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">440x</span>
<span class="cline-any cline-yes">439x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3054x</span>
<span class="cline-any cline-yes">3052x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20340x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20340x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20338x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4032x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4032x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4032x</span>
<span class="cline-any cline-yes">6671x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6670x</span>
<span class="cline-any cline-yes">715x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6670x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4030x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">440x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">439x</span>
<span class="cline-any cline-yes">439x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3054x</span>
<span class="cline-any cline-yes">3054x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3054x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3053x</span>
<span class="cline-any cline-yes">3057x</span>
<span class="cline-any cline-yes">3057x</span>
<span class="cline-any cline-yes">3057x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3053x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3053x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">715x</span>
<span class="cline-any cline-yes">715x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">715x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">437x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">437x</span>
<span class="cline-any cline-yes">713x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">713x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">437x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-yes">4026x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4026x</span>
<span class="cline-any cline-yes">455x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4026x</span>
<span class="cline-any cline-yes">4026x</span>
<span class="cline-any cline-yes">437x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4026x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4025x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-yes">29x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-yes">7094x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7094x</span>
<span class="cline-any cline-yes">3054x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7094x</span>
<span class="cline-any cline-yes">4024x</span>
<span class="cline-any cline-yes">4024x</span>
<span class="cline-any cline-yes">4024x</span>
<span class="cline-any cline-yes">4024x</span>
<span class="cline-any cline-yes">4024x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import {Token} from "./Token";
import {TokenType} from "./types/TokenType";
import {AssemblerError} from "./errors/AssemblerError";
import {AsmInstruction} from "./asmInstructions/AsmInstruction";
import {MEMORY_LENGTH, PROGRAM_OFFSET} from "./types/Chip8Specs";
import {ILabelReference} from "./interfaces/ILabelReference";
import {asmInstructionFactory} from "./asmInstructions/asmInstructionFactory";
&nbsp;
export class Assembler {
    public readonly program: Uint8Array = new Uint8Array([]);
&nbsp;
    private readonly tokens: Array&lt;Token&gt;;
    //keeps track all all valid asm instructions
    private instructions: Array&lt;AsmInstruction&gt; = [];
    //Keep track of all program labels
    private programLabels: Array&lt;string&gt; = [];
    //Stores a label name at where it occurred in the assembly (referred to as the program index).
    private labelLocations: Map&lt;number, string&gt; = new Map();
    //Stores all references made to program labels
    private labelReferences: Map&lt;string, Array&lt;ILabelReference&gt;&gt; = new Map();
    //Stores all unreachable code (address : value)
    private data: Map&lt;number, number&gt; = new Map();
    private maxDataOffset: number = 0;
&nbsp;
&nbsp;
    constructor(tokens: Array&lt;Token&gt;) {
        this.tokens = tokens.slice();
        this.program = this.parse();
    }
&nbsp;
    private parse(): Uint8Array {
        while (true) {
            const nextToken = this.getNextToken();
&nbsp;
            switch (nextToken.type) {
                case TokenType.INSTRUCTION:
                    this.parseInstructionToken(nextToken);
                    break;
                case TokenType.LABEL:
                    this.parseProgramLabelToken(nextToken);
                    break;
                case TokenType.DATA:
                    this.parseDataToken();
                    break;
                case TokenType.EOF:
                    return this.generateProgram();
                default:
                    throw new AssemblerError('Arrived at an invalid token', nextToken)
            }
        }
    }
&nbsp;
    private getNextToken(): Token {
        const token = this.tokens.shift();
&nbsp;
        if (typeof token === 'undefined')
            throw new AssemblerError('Received an undefined token in an unexpected place. Either an undefined value made it into the token stream, or an EOF token was not present');
&nbsp;
        return token;
    }
&nbsp;
    private parseInstructionToken(token: Token): void {
        let assembler = asmInstructionFactory(token, ...this.tokens.slice(0, 2));
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (assembler === false)
<span class="cstat-no" title="statement not covered" >            throw new AssemblerError('Encountered a mysterious token', token);</span>
&nbsp;
        for (let i = 0; i &lt; assembler.assemblyData.nArgs; i += 1) {
            const param = this.getNextToken();
&nbsp;
            //If the parameter token is a label, we need to keep track of it and resolve it to an actual memory address down the line
            if (param.is(TokenType.LABEL))
                this.addLabelReference(param.value, this.instructions.length, i);
&nbsp;
            //Add the parameter to the assembler
            assembler.addParam(param);
        }
&nbsp;
        this.instructions.push(assembler);
    }
&nbsp;
    private parseProgramLabelToken(token: Token): void {
        if (this.programLabels.includes(token.value))
            throw new AssemblerError(`Received a duplicate label token`, token);
&nbsp;
        this.labelLocations.set(this.instructions.length, token.value);
        this.programLabels.push(token.value);
    }
&nbsp;
    /**
     * Data Tokens are an assembler-specific instruction.
     *
     * A valid program contains at least two integer token following a data token:
     *  The first is the memory address to place the data
     *  The second is the value of the data to store in memory
     *
     * Any proceeding integer tokens is considered to be data @ initial memory location + the nth integer token.
     */
    private parseDataToken() {
        const memoryLocationToken = this.getNextToken();
        let memoryLocation = memoryLocationToken.value;
&nbsp;
        if (!memoryLocationToken.is(TokenType.INTEGER))
            throw new AssemblerError('Data instruction expects to receive a memory location as it\'s first param.', memoryLocationToken);
&nbsp;
        while (this.tokens[0].is(TokenType.INTEGER)) {
            let dataToken = this.getNextToken();
            this.data.set(memoryLocation, dataToken.value);
            memoryLocation++;
        }
        this.maxDataOffset = (this.maxDataOffset &lt; memoryLocation) ? memoryLocation : <span class="branch-1 cbranch-no" title="branch not covered" >this.maxDataOffset;</span>
&nbsp;
        if (memoryLocation === memoryLocationToken.value)
            throw new AssemblerError('The data instruction expects at least one value.', this.tokens[0]);
    }
&nbsp;
    /**
     * Distinct from a Program Label Token, a label reference is an instruction argument.
     *
     * Before assembling the program, all label references must be accounted for.
     *
     * Multiple instructions may reference the same Program Label, so we store references in a
     * one-to-many structure.
     *
     * @param label - The labelname
     * @param instructionIndex - the program index, or the location in the assembly where the label reference occurred
     * @param parameterIndex - the argument number the label reference exists at.
     */
    private addLabelReference(label: string, instructionIndex: number, parameterIndex: number) {
        let references: Array&lt;ILabelReference&gt; = this.labelReferences.get(label) || [];
        references.push({instructionIndex, parameterIndex});
&nbsp;
        this.labelReferences.set(label, references);
    }
&nbsp;
    /**
     * Resolve any label references associated with a label name to a location in memory
     *
     * @param labelName - Name of the program label
     * @param memoryLocation - Location in memory
     */
    private resolve(labelName: string, memoryLocation: number) {
        const references = this.labelReferences.get(labelName) || <span class="branch-1 cbranch-no" title="branch not covered" >[];</span>
&nbsp;
        references.forEach(reference =&gt; {
            const {instructionIndex, parameterIndex} = reference;
&nbsp;
            this.instructions[instructionIndex].resolveLabel(parameterIndex, labelName, memoryLocation);
        });
&nbsp;
        //Once the labels have been resolved to actual memory locations, remove them.
        // If some exist after all memory calculations have been made, it means that
        // some instructions reference labels that do not exist and the program is
        // not valid.
        this.labelReferences.delete(labelName!);
    }
&nbsp;
    /**
     * For all instructions in the assembly, determine where they belong in memory.
     * The following algorithm is used:
     *
     *  Starting from the Chip8 program offset as an initial memory index and 0 as the initial program index,
     *
     *  If data exists at a given memory index, increment the memory index by one until no data occupies the current index
     *
     *  If a label exists at a given program index, resolve all references to that label with the current memory index
     *
     *  Associate the instruction at program index with the current memory index and move on to the next instruction.
     *  Note: memoryIndex must be incremented by two because instructions occupy two bytes in memory.
     */
    private calculateMemoryLocations(): { [key: number]: AsmInstruction } {
        const memoryLocations: { [key: number]: AsmInstruction } = {};
&nbsp;
        let programIndex = 0;
        let memoryIndex = PROGRAM_OFFSET;
&nbsp;
        for (; programIndex &lt; this.instructions.length; programIndex += 1, memoryIndex += 2) {
            const instruction = this.instructions[programIndex];
            //skip any locations in memory reserved for data
            while (this.data.has(memoryIndex))
                memoryIndex += 1;
&nbsp;
            //if a label exists at this program index, we need to resolve any instructions that refer to it
            const labelName = this.labelLocations.get(programIndex);
            if (labelName)
                this.resolve(labelName, memoryIndex);
&nbsp;
            //If there's not enough room to write the current instruction into memory, the program isn't valid
            if (this.data.has(memoryIndex + 1))
                throw new AssemblerError(`Data and Instruction collide at ${memoryIndex}`, instruction.instruction);
&nbsp;
            memoryLocations[memoryIndex] = instruction;
        }
&nbsp;
        //There can exist labels that are not referenced, but a program that references non-existent labels is invalid.
        if (this.labelReferences.size &gt; 0)
            throw new AssemblerError('The assembly references labels that do not exist');
&nbsp;
        return memoryLocations;
    }
&nbsp;
    /**
     * Calculate the size of the program and the memory locations of data / instructions.
     * For each byte in the program, write data and assembled instructions to a buffer.
     */
    private generateProgram(): Uint8Array {
        const programSize: number = Math.max(
            this.maxDataOffset - PROGRAM_OFFSET,
            this.instructions.length * 2 + this.data.size
        );
        const program: Array&lt;number&gt; = new Array&lt;number&gt;(programSize).fill(0);
        const memoryMap = this.calculateMemoryLocations();
&nbsp;
        //The program is invalid if the calculated program size if greater
        // than the size of the chip8 memory space.
        //Note: we have to account from whatever the program size it + the program offset.
        if ((programSize+PROGRAM_OFFSET) &gt; MEMORY_LENGTH)
            throw new AssemblerError('Assembled program is greater than max chip memory space.');
&nbsp;
        for (let programIndex = 0; programIndex &lt; programSize; programIndex += 1) {
            let memoryIndex = programIndex + PROGRAM_OFFSET;
&nbsp;
            if (this.data.has(memoryIndex))
                program[programIndex] = this.data.get(memoryIndex)!;
&nbsp;
            if (memoryMap[memoryIndex]) {
                const opcode = memoryMap[memoryIndex].assemble();
                const HIGH = (opcode &amp; 0xFF00) &gt;&gt; 8;
                const LOW = (opcode &amp; 0xFF) || 0;
                program[programIndex] = HIGH;
                program[++programIndex] = LOW;
            }
        }
&nbsp;
        return new Uint8Array(program);
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sat Feb 02 2019 08:12:29 GMT-0800 (PST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
